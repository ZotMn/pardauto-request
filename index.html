<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–ó –Ω–∞ –ø–æ–¥–±–æ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* --- –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò --- */
        :root {
            --primary-color: #0056b3;
            --secondary-color: #f4f7f6;
            --text-color: #333;
            --border-color: #ccc;
            --budget-color: #0d47a1;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.4;
            color: var(--text-color);
            background-color: #e9ecef;
            margin: 0;
            padding: 10px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .logo-container {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        .logo-img {
            max-width: 200px; /* –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ª–æ–≥–æ */
            height: auto;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .section-block { margin-bottom: 20px; }

        h2 {
            background-color: var(--secondary-color);
            padding: 8px 15px;
            border-left: 5px solid var(--primary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        @media (max-width: 480px) {
            .form-grid { grid-template-columns: 1fr; }
        }

        .form-group { margin-bottom: 10px; }
        .form-group.full-width { grid-column: 1 / -1; }

        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            font-size: 0.85rem;
            color: #555;
        }

        input[type="text"], select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px; 
            font-family: inherit;
        }
        textarea { resize: vertical; height: 60px; }

        .budget-block {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #bbdefb;
        }
        .budget-label { font-size: 1.1rem; color: var(--budget-color); margin-bottom: 8px; }
        .budget-input { font-weight: bold; font-size: 1.1rem; color: var(--budget-color); }

        .required { color: red; }

        .btn-container {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .btn {
            padding: 15px 30px;
            border: none; border-radius: 5px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer; color: white;
            width: 100%; max-width: 300px;
        }
        .btn-pdf { background-color: var(--primary-color); }
        .btn-pdf:disabled { background-color: #999; cursor: wait; }

        /* --- –°–¢–ò–õ–ò –î–õ–Ø –°–ö–†–´–¢–û–ì–û –ö–õ–û–ù–ê (–î–õ–Ø PDF) --- */
        #clone-container {
            position: absolute;
            top: -9999px;
            left: -9999px;
            width: 800px; /* –§–∏–∫—Å–∏—Ä—É–µ–º —à–∏—Ä–∏–Ω—É –¥–ª—è PDF */
            background: white;
            z-index: -1;
        }
        
        /* –°—Ç–∏–ª–∏ –≤–Ω—É—Ç—Ä–∏ PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞ */
        .pdf-mode body { padding: 0; }
        .pdf-mode .container { box-shadow: none; padding: 0 20px; max-width: 100%; }
        .pdf-mode input, .pdf-mode select, .pdf-mode textarea {
            border: none !important;
            background: transparent !important;
            padding: 0;
            font-weight: bold;
            color: #000;
            resize: none;
            /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–µ–ª–∫–∏ —Å–µ–ª–µ–∫—Ç–æ–≤ –∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã */
            -webkit-appearance: none;
            appearance: none;
        }
        .pdf-mode .budget-block { border: 2px solid #0d47a1; background: #fff; }
        .pdf-mode .required { display: none; }
        .pdf-mode ::placeholder { color: transparent; }
        
        /* –ó–∞–º–µ–Ω–∞ –∏–Ω–ø—É—Ç–æ–≤ –Ω–∞ —Ç–µ–∫—Å—Ç –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã */
        .pdf-text-value {
            font-weight: bold;
            color: #000;
            font-size: 1rem;
            padding: 2px 0;
            border-bottom: 1px solid #eee;
            min-height: 20px;
        }
        .pdf-text-value.budget-val {
            color: #0d47a1;
            font-size: 1.2rem;
            border: none;
        }
    </style>
</head>
<body>

<!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ -->
<div class="container" id="printable-area">
    <div class="logo-container">
        <!-- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª logo.png –ª–µ–∂–∏—Ç —Ä—è–¥–æ–º -->
        <img src="logo.png" alt="Pard Auto" class="logo-img" crossorigin="anonymous">
    </div>

    <h1>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –ø–æ–¥–±–æ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è</h1>

    <div class="section-block">
        <h2>1. –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞</h2>
        <div class="form-grid">
            <div class="form-group">
                <label for="managerName">–ú–µ–Ω–µ–¥–∂–µ—Ä: <span class="required">*</span></label>
                <select id="managerName" required>
                    <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                    <option value="–ê—Ä—Ç–µ–º">–ê—Ä—Ç–µ–º</option>
                    <option value="–ú–∞–∫—Å–∏–º">–ú–∞–∫—Å–∏–º</option>
                    <option value="–†–æ–º–∞–Ω">–†–æ–º–∞–Ω</option>
                </select>
            </div>
            <div class="form-group">
                <label for="requestDate">–î–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞:</label>
                <input type="text" id="requestDate" readonly>
            </div>
        </div>
    </div>

    <div class="section-block">
        <h2>2. –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞</h2>
        <div class="form-grid">
            <div class="form-group">
                <label for="clientFIO">–§–ò–û –ö–ª–∏–µ–Ω—Ç–∞: <span class="required">*</span></label>
                <input type="text" id="clientFIO" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" required>
            </div>
            <div class="form-group">
                <label for="clientPhone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="text" id="clientPhone" placeholder="+7 (999) 000-00-00">
            </div>
        </div>
    </div>

    <div class="section-block">
        <h2>3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≤—Ç–æ–º–æ–±–∏–ª—è</h2>
        <div class="form-grid">
            <div class="form-group full-width budget-block">
                <label class="budget-label">üéØ –ë—é–¥–∂–µ—Ç ¬´–ø–æ–¥ –∫–ª—é—á¬ª (–†–§): <span class="required">*</span></label>
                <input type="text" id="budget" class="budget-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¥–æ 3 500 000 —Ä—É–±." required>
            </div>

            <div class="form-group full-width">
                <label>–ú–∞—Ä–∫–∞ –∏ –ú–æ–¥–µ–ª—å: <span class="required">*</span></label>
                <input type="text" id="carMakeModel" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Kia Sorento" required>
            </div>

            <div class="form-group">
                <label>–ì–æ–¥—ã –≤—ã–ø—É—Å–∫–∞:</label>
                <input type="text" id="carYears" placeholder="2020-2022">
            </div>

            <div class="form-group">
                <label>–î–≤–∏–≥–∞—Ç–µ–ª—å:</label>
                <input type="text" id="engineType" placeholder="–î–∏–∑–µ–ª—å 2.2">
            </div>
            <div class="form-group">
                <label>–ü—Ä–∏–≤–æ–¥:</label>
                <select id="driveType">
                    <option value="–ù–µ –≤–∞–∂–Ω–æ">–ù–µ –≤–∞–∂–Ω–æ</option>
                    <option value="–ü–æ–ª–Ω—ã–π (4WD/AWD)">–ü–æ–ª–Ω—ã–π (4WD/AWD)</option>
                    <option value="–ü–µ—Ä–µ–¥–Ω–∏–π (FWD)">–ü–µ—Ä–µ–¥–Ω–∏–π (FWD)</option>
                    <option value="–ó–∞–¥–Ω–∏–π (RWD)">–ó–∞–¥–Ω–∏–π (RWD)</option>
                </select>
            </div>

            <div class="form-group">
                <label>–ö–æ—Ä–æ–±–∫–∞:</label>
                <select id="transmission">
                    <option value="–ê–≤—Ç–æ–º–∞—Ç (–ª—é–±–æ–π)">–ê–≤—Ç–æ–º–∞—Ç (–ª—é–±–æ–π)</option>
                    <option value="–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ê–ö–ü–ü">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ê–ö–ü–ü</option>
                    <option value="–†–æ–±–æ—Ç">–†–æ–±–æ—Ç</option>
                    <option value="–í–∞—Ä–∏–∞—Ç–æ—Ä">–í–∞—Ä–∏–∞—Ç–æ—Ä</option>
                    <option value="–ú–µ—Ö–∞–Ω–∏–∫–∞">–ú–µ—Ö–∞–Ω–∏–∫–∞</option>
                </select>
            </div>
             <div class="form-group">
                <label>–ü—Ä–æ–±–µ–≥ (–∫–º):</label>
                <input type="text" id="maxMileage" placeholder="–¥–æ 80 000">
            </div>

            <div class="form-group">
                <label>–û—Ç–∫—É–¥–∞ –ø—Ä–∏–≤–µ–∑—Ç–∏:</label>
                <select id="importRegion">
                    <option value="–ù–µ –≤–∞–∂–Ω–æ">–ù–µ –≤–∞–∂–Ω–æ</option>
                    <option value="–ö–∏—Ç–∞–π">–ö–∏—Ç–∞–π</option>
                    <option value="–ö–æ—Ä–µ—è">–ö–æ—Ä–µ—è</option>
                    <option value="–ï–≤—Ä–æ–ø–∞">–ï–≤—Ä–æ–ø–∞</option>
                    <option value="–Ø–ø–æ–Ω–∏—è">–Ø–ø–æ–Ω–∏—è</option>
                </select>
            </div>

            <div class="form-group">
                <label>–ì–æ—Ä–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏:</label>
                <input type="text" id="deliveryCity" placeholder="–ú–æ—Å–∫–≤–∞">
            </div>

            <div class="form-group">
                <label>–†–∞—Å—Ç–∞–º–æ–∂–∫–∞:</label>
                <select id="customsClearance">
                    <option value="–†–§">–†–§</option>
                    <option value="–ö–∏—Ä–≥–∏–∑–∏—è">–ö–∏—Ä–≥–∏–∑–∏—è</option>
                    <option value="–†–ë">–†–ë</option>
                </select>
            </div>

            <div class="form-group full-width">
                <label>–¶–≤–µ—Ç (–ö—É–∑–æ–≤/–°–∞–ª–æ–Ω):</label>
                <input type="text" id="colors" placeholder="–ë–µ–ª—ã–π / –¢–µ–º–Ω—ã–π">
            </div>
            
            <div class="form-group full-width">
                <label>–í–∞–∂–Ω—ã–µ –æ–ø—Ü–∏–∏ (Must Have):</label>
                <textarea id="mustHaves" placeholder="–ü–∞–Ω–æ—Ä–∞–º–∞, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è..."></textarea>
            </div>

            <div class="form-group full-width">
                <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</label>
                <textarea id="additionalComments" placeholder="–õ—é–±–∞—è –¥—Ä—É–≥–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è."></textarea>
            </div>
        </div>
    </div>
</div>

<div class="btn-container">
    <button class="btn btn-pdf" id="pdfBtn" onclick="generateSmartPDF()">–°–∫–∞—á–∞—Ç—å / –û—Ç–ø—Ä–∞–≤–∏—Ç—å PDF</button>
</div>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–ª–æ–Ω–∞ -->
<div id="clone-container"></div>

<script>
    window.onload = function() {
        const today = new Date();
        document.getElementById('requestDate').value = today.toLocaleString('ru-RU', { 
            year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' 
        });
    };

    function validateForm() {
        const req = [
            {id: 'managerName', msg: '–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞!'},
            {id: 'clientFIO', msg: '–£–∫–∞–∂–∏—Ç–µ –§–ò–û –∫–ª–∏–µ–Ω—Ç–∞!'},
            {id: 'budget', msg: '–£–∫–∞–∂–∏—Ç–µ –±—é–¥–∂–µ—Ç!'},
            {id: 'carMakeModel', msg: '–£–∫–∞–∂–∏—Ç–µ –º–∞—Ä–∫—É –∞–≤—Ç–æ!'}
        ];
        for (let item of req) {
            let el = document.getElementById(item.id);
            if (!el.value || !el.value.trim()) {
                alert(item.msg); el.focus(); return false;
            }
        }
        return true;
    }

    function getFileName() {
        const manager = document.getElementById('managerName').value || 'Mngr';
        const client = (document.getElementById('clientFIO').value || 'Client').trim().split(' ')[0];
        const car = (document.getElementById('carMakeModel').value || 'Car').trim().split(' ').slice(0,2).join('_');
        const now = new Date();
        const dateStr = now.toLocaleDateString('ru-RU').replace(/\./g, '-');
        const timeStr = now.toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'}).replace(/:/g, '-');
        return `–¢–ó_${manager}_${client}_${car}_${dateStr}_${timeStr}.pdf`;
    }

    // --- –ì–õ–ê–í–ù–ê–Ø –ú–ê–ì–ò–Ø: –ü–û–î–ì–û–¢–û–í–ö–ê –ö–õ–û–ù–ê –î–õ–Ø –ü–ï–ß–ê–¢–ò ---
    function prepareClone() {
        const original = document.getElementById('printable-area');
        const cloneContainer = document.getElementById('clone-container');
        cloneContainer.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞
        
        // –ö–ª–æ–Ω–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫
        const clone = original.cloneNode(true);
        clone.classList.add('pdf-mode'); // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü. –∫–ª–∞—Å—Å
        
        // –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤—Å–µ INPUT –∏ SELECT –≤ –∫—Ä–∞—Å–∏–≤—ã–π –¢–ï–ö–°–¢
        // –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å–µ—Ä—ã—Ö –ø–æ–ª–µ–π –∏ –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
        const inputs = clone.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            const val = input.value || '';
            const textDiv = document.createElement('div');
            textDiv.textContent = val;
            textDiv.className = 'pdf-text-value';
            
            // –ï—Å–ª–∏ —ç—Ç–æ –±—é–¥–∂–µ—Ç - –≤—ã–¥–µ–ª—è–µ–º
            if(input.id === 'budget' || input.classList.contains('budget-input')) {
                textDiv.classList.add('budget-val');
            }
            
            // –ó–∞–º–µ–Ω—è–µ–º input –Ω–∞ div —Å —Ç–µ–∫—Å—Ç–æ–º
            input.parentNode.replaceChild(textDiv, input);
        });

        cloneContainer.appendChild(clone);
        return clone;
    }

    function generateSmartPDF() {
        if (!validateForm()) return;

        const btn = document.getElementById('pdfBtn');
        const originalText = btn.innerText;
        btn.innerText = "–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞...";
        btn.disabled = true;

        // 1. –°–æ–∑–¥–∞–µ–º –∏–¥–µ–∞–ª—å–Ω—É—é –∫–æ–ø–∏—é –¥–ª—è –ø–µ—á–∞—Ç–∏
        const elementToPrint = prepareClone();
        const fileName = getFileName();

        // 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ PDF
        const opt = {
            margin: [10, 10, 10, 10],
            filename: fileName,
            image: { type: 'jpeg', quality: 0.99 },
            html2canvas: { 
                scale: 2, 
                useCORS: true, 
                logging: false,
                scrollY: 0,
                windowWidth: 800 // –í–ê–ñ–ù–û: –ó–∞—Å—Ç–∞–≤–ª—è–µ–º –¥—É–º–∞—Ç—å, —á—Ç–æ —ç–∫—Ä–∞–Ω —à–∏—Ä–æ–∫–∏–π
            },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        // 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –®–∞—Ä–∏–Ω–≥
        html2pdf().set(opt).from(elementToPrint).output('blob').then(function(blob) {
            const file = new File([blob], fileName, { type: 'application/pdf' });
            
            // –ï—Å–ª–∏ –º–æ–±–∏–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
            if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                navigator.share({
                    files: [file],
                    title: '–¢–ó –Ω–∞ –∞–≤—Ç–æ',
                    text: '–¢–ó –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞: ' + fileName
                }).then(() => {
                    resetBtn();
                }).catch(() => {
                    // –ï—Å–ª–∏ –∑–∞–∫—Ä—ã–ª–∏ –º–µ–Ω—é - –ø—Ä–æ—Å—Ç–æ –∫–∞—á–∞–µ–º
                    saveDirectly(opt, elementToPrint);
                });
            } else {
                // –ö–æ–º–ø—å—é—Ç–µ—Ä –∏–ª–∏ —Å—Ç–∞—Ä—ã–π –∞–Ω–¥—Ä–æ–∏–¥
                saveDirectly(opt, elementToPrint);
            }
        }).catch(err => {
            console.error(err);
            alert("–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
            resetBtn();
        });

        function saveDirectly(options, el) {
            html2pdf().set(options).from(el).save().then(resetBtn);
        }

        function resetBtn() {
            btn.innerText = originalText;
            btn.disabled = false;
            // –û—á–∏—â–∞–µ–º –∫–ª–æ–Ω –∏–∑ –ø–∞–º—è—Ç–∏
            document.getElementById('clone-container').innerHTML = '';
        }
    }
</script>
</body>
</html>
