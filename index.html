<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–ó –Ω–∞ –ø–æ–¥–±–æ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* --- –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò (–î–õ–Ø –≠–ö–†–ê–ù–ê –¢–ï–õ–ï–§–û–ù–ê/–ö–û–ú–ü–ê) --- */
        :root {
            --primary-color: #0056b3;
            --secondary-color: #f4f7f6;
            --text-color: #333;
            --border-color: #ccc;
            --budget-color: #0d47a1;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.4;
            color: var(--text-color);
            background-color: #e9ecef;
            margin: 0;
            padding: 10px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .logo-container {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        .logo-img {
            max-width: 200px;
            height: auto;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .section-block { margin-bottom: 20px; }

        h2 {
            background-color: var(--secondary-color);
            padding: 8px 15px;
            border-left: 5px solid var(--primary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        @media (max-width: 480px) {
            .form-grid { grid-template-columns: 1fr; }
        }

        .form-group { margin-bottom: 10px; }
        .form-group.full-width { grid-column: 1 / -1; }

        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            font-size: 0.85rem;
            color: #555;
        }

        input[type="text"], select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
            font-family: inherit;
        }
        textarea { resize: vertical; height: 60px; }

        .budget-block {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #bbdefb;
        }
        .budget-label { font-size: 1.1rem; color: var(--budget-color); margin-bottom: 8px; }
        .budget-input { font-weight: bold; font-size: 1.1rem; color: var(--budget-color); }

        .required { color: red; }

        .btn-container {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .btn {
            padding: 15px 30px;
            border: none; border-radius: 5px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer; color: white;
            width: 100%; max-width: 300px;
        }
        .btn-pdf { background-color: var(--primary-color); }
        .btn-pdf:disabled { background-color: #999; cursor: wait; }

        /* --- –°–¢–ò–õ–ò –ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–û –î–õ–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò PDF --- */
        /* –≠—Ç–æ—Ç –±–ª–æ–∫ –Ω–µ –≤–∏–¥–µ–Ω –Ω–∞ —ç–∫—Ä–∞–Ω–µ, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è PDF */
        #clone-container {
            position: absolute;
            top: -9999px;
            left: 0; 
        }

        /* –ñ–µ—Å—Ç–∫–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è —à–∏—Ä–∏–Ω—ã –¥–ª—è PDF - —ç—Ç–æ —Ä–µ—à–∏—Ç –ø—Ä–æ–±–ª–µ–º—É —Å –∫–æ–º–ø–∞ */
        .pdf-mode {
            width: 750px !important; /* –®–∏—Ä–∏–Ω–∞ A4 –ø—Ä–∏ 96dpi –ø—Ä–∏–º–µ—Ä–Ω–æ 794px, –±–µ—Ä–µ–º —Å –∑–∞–ø–∞—Å–æ–º */
            padding: 20px 40px !important; /* –û—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏ –ª–∏—Å—Ç–∞ */
            background: white !important;
            box-sizing: border-box !important;
        }

        .pdf-mode .logo-container { text-align: center; margin-bottom: 20px; }
        .pdf-mode .logo-img { max-width: 250px; } /* –õ–æ–≥–æ—Ç–∏–ø –∫—Ä—É–ø–Ω–µ–µ –∏ —á–µ—Ç—á–µ –≤ PDF */

        .pdf-mode .form-grid {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important; /* –í—Å–µ–≥–¥–∞ 2 –∫–æ–ª–æ–Ω–∫–∏ –≤ PDF */
            gap: 15px !important;
        }
        .pdf-mode .form-group.full-width { grid-column: 1 / -1 !important; }

        /* –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –∏–Ω–ø—É—Ç—ã –≤ –∫—Ä–∞—Å–∏–≤—ã–π —Ç–µ–∫—Å—Ç */
        .pdf-mode input, .pdf-mode select, .pdf-mode textarea {
            display: none !important; /* –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞—Å—Ç–æ—è—â–∏–µ –∏–Ω–ø—É—Ç—ã */
        }
        
        .pdf-text-value {
            font-family: 'Segoe UI', sans-serif;
            font-size: 14px;
            color: #000;
            font-weight: 600;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
            min-height: 20px;
            white-space: pre-wrap; /* –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –∏–∑ textarea */
        }
        
        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ */
        .pdf-mode .budget-block {
            background: #f0f7ff !important;
            border: 2px solid #0d47a1 !important;
            padding: 10px !important;
        }
        .pdf-mode .budget-label {
            color: #0d47a1 !important;
            font-size: 14px !important;
            margin-bottom: 5px !important;
        }
        .pdf-text-value.budget-val {
            color: #0d47a1 !important;
            font-size: 18px !important; /* –ö—Ä—É–ø–Ω–æ, –Ω–æ –Ω–µ –≥–∏–≥–∞–Ω—Ç—Å–∫–∏ */
            font-weight: 800 !important;
            border: none !important;
        }
    </style>
</head>
<body>

<!-- –í–∏–¥–∏–º–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è -->
<div class="container" id="printable-area">
    <div class="logo-container">
        <img src="logo.png" alt="Pard Auto" class="logo-img" crossorigin="anonymous">
    </div>

    <h1>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –ø–æ–¥–±–æ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è</h1>

    <div class="section-block">
        <h2>1. –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞</h2>
        <div class="form-grid">
            <div class="form-group">
                <label for="managerName">–ú–µ–Ω–µ–¥–∂–µ—Ä: <span class="required">*</span></label>
                <select id="managerName" required>
                    <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                    <option value="–ê—Ä—Ç–µ–º">–ê—Ä—Ç–µ–º</option>
                    <option value="–ú–∞–∫—Å–∏–º">–ú–∞–∫—Å–∏–º</option>
                    <option value="–†–æ–º–∞–Ω">–†–æ–º–∞–Ω</option>
                </select>
            </div>
            <div class="form-group">
                <label for="requestDate">–î–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞:</label>
                <input type="text" id="requestDate" readonly>
            </div>
        </div>
    </div>

    <div class="section-block">
        <h2>2. –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞</h2>
        <div class="form-grid">
            <div class="form-group">
                <label for="clientFIO">–§–ò–û –ö–ª–∏–µ–Ω—Ç–∞: <span class="required">*</span></label>
                <input type="text" id="clientFIO" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" required>
            </div>
            <div class="form-group">
                <label for="clientPhone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="text" id="clientPhone" placeholder="+7 (999) 000-00-00">
            </div>
        </div>
    </div>

    <div class="section-block">
        <h2>3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≤—Ç–æ–º–æ–±–∏–ª—è</h2>
        <div class="form-grid">
            <div class="form-group full-width budget-block">
                <label class="budget-label">üéØ –ë—é–¥–∂–µ—Ç ¬´–ø–æ–¥ –∫–ª—é—á¬ª (–†–§): <span class="required">*</span></label>
                <input type="text" id="budget" class="budget-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¥–æ 3 500 000 —Ä—É–±." required>
            </div>

            <div class="form-group full-width">
                <label>–ú–∞—Ä–∫–∞ –∏ –ú–æ–¥–µ–ª—å: <span class="required">*</span></label>
                <input type="text" id="carMakeModel" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Kia Sorento" required>
            </div>

            <div class="form-group">
                <label>–ì–æ–¥—ã –≤—ã–ø—É—Å–∫–∞:</label>
                <input type="text" id="carYears" placeholder="2020-2022">
            </div>

            <div class="form-group">
                <label>–î–≤–∏–≥–∞—Ç–µ–ª—å:</label>
                <input type="text" id="engineType" placeholder="–î–∏–∑–µ–ª—å 2.2">
            </div>
            <div class="form-group">
                <label>–ü—Ä–∏–≤–æ–¥:</label>
                <select id="driveType">
                    <option value="–ù–µ –≤–∞–∂–Ω–æ">–ù–µ –≤–∞–∂–Ω–æ</option>
                    <option value="–ü–æ–ª–Ω—ã–π (4WD/AWD)">–ü–æ–ª–Ω—ã–π (4WD/AWD)</option>
                    <option value="–ü–µ—Ä–µ–¥–Ω–∏–π (FWD)">–ü–µ—Ä–µ–¥–Ω–∏–π (FWD)</option>
                    <option value="–ó–∞–¥–Ω–∏–π (RWD)">–ó–∞–¥–Ω–∏–π (RWD)</option>
                </select>
            </div>

            <div class="form-group">
                <label>–ö–æ—Ä–æ–±–∫–∞:</label>
                <select id="transmission">
                    <option value="–ê–≤—Ç–æ–º–∞—Ç (–ª—é–±–æ–π)">–ê–≤—Ç–æ–º–∞—Ç (–ª—é–±–æ–π)</option>
                    <option value="–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ê–ö–ü–ü">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ê–ö–ü–ü</option>
                    <option value="–†–æ–±–æ—Ç">–†–æ–±–æ—Ç</option>
                    <option value="–í–∞—Ä–∏–∞—Ç–æ—Ä">–í–∞—Ä–∏–∞—Ç–æ—Ä</option>
                    <option value="–ú–µ—Ö–∞–Ω–∏–∫–∞">–ú–µ—Ö–∞–Ω–∏–∫–∞</option>
                </select>
            </div>
             <div class="form-group">
                <label>–ü—Ä–æ–±–µ–≥ (–∫–º):</label>
                <input type="text" id="maxMileage" placeholder="–¥–æ 80 000">
            </div>

            <div class="form-group">
                <label>–û—Ç–∫—É–¥–∞ –ø—Ä–∏–≤–µ–∑—Ç–∏:</label>
                <select id="importRegion">
                    <option value="–ù–µ –≤–∞–∂–Ω–æ">–ù–µ –≤–∞–∂–Ω–æ</option>
                    <option value="–ö–∏—Ç–∞–π">–ö–∏—Ç–∞–π</option>
                    <option value="–ö–æ—Ä–µ—è">–ö–æ—Ä–µ—è</option>
                    <option value="–ï–≤—Ä–æ–ø–∞">–ï–≤—Ä–æ–ø–∞</option>
                    <option value="–Ø–ø–æ–Ω–∏—è">–Ø–ø–æ–Ω–∏—è</option>
                </select>
            </div>

            <div class="form-group">
                <label>–ì–æ—Ä–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏:</label>
                <input type="text" id="deliveryCity" placeholder="–ú–æ—Å–∫–≤–∞">
            </div>

            <div class="form-group">
                <label>–†–∞—Å—Ç–∞–º–æ–∂–∫–∞:</label>
                <select id="customsClearance">
                    <option value="–†–§">–†–§</option>
                    <option value="–ö–∏—Ä–≥–∏–∑–∏—è">–ö–∏—Ä–≥–∏–∑–∏—è</option>
                    <option value="–†–ë">–†–ë</option>
                </select>
            </div>

            <div class="form-group full-width">
                <label>–¶–≤–µ—Ç (–ö—É–∑–æ–≤/–°–∞–ª–æ–Ω):</label>
                <input type="text" id="colors" placeholder="–ë–µ–ª—ã–π / –¢–µ–º–Ω—ã–π">
            </div>
            
            <div class="form-group full-width">
                <label>–í–∞–∂–Ω—ã–µ –æ–ø—Ü–∏–∏ (Must Have):</label>
                <textarea id="mustHaves" placeholder="–ü–∞–Ω–æ—Ä–∞–º–∞, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è..."></textarea>
            </div>

            <div class="form-group full-width">
                <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</label>
                <textarea id="additionalComments" placeholder="–õ—é–±–∞—è –¥—Ä—É–≥–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è."></textarea>
            </div>
        </div>
    </div>
</div>

<div class="btn-container">
    <button class="btn btn-pdf" id="pdfBtn" onclick="generateSmartPDF()">–°–∫–∞—á–∞—Ç—å / –û—Ç–ø—Ä–∞–≤–∏—Ç—å PDF</button>
</div>

<!-- –°—é–¥–∞ –±—É–¥–µ—Ç –ø–æ–º–µ—â–∞—Ç—å—Å—è –∫–æ–ø–∏—è –¥–ª—è –ø–µ—á–∞—Ç–∏ -->
<div id="clone-container"></div>

<script>
    window.onload = function() {
        const today = new Date();
        document.getElementById('requestDate').value = today.toLocaleString('ru-RU', { 
            year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' 
        });
    };

    function validateForm() {
        const req = [
            {id: 'managerName', msg: '–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞!'},
            {id: 'clientFIO', msg: '–£–∫–∞–∂–∏—Ç–µ –§–ò–û –∫–ª–∏–µ–Ω—Ç–∞!'},
            {id: 'budget', msg: '–£–∫–∞–∂–∏—Ç–µ –±—é–¥–∂–µ—Ç!'},
            {id: 'carMakeModel', msg: '–£–∫–∞–∂–∏—Ç–µ –º–∞—Ä–∫—É –∞–≤—Ç–æ!'}
        ];
        for (let item of req) {
            let el = document.getElementById(item.id);
            if (!el.value || !el.value.trim()) {
                alert(item.msg); el.focus(); return false;
            }
        }
        return true;
    }

    function getFileName() {
        const manager = document.getElementById('managerName').value || 'Mngr';
        const client = (document.getElementById('clientFIO').value || 'Client').trim().split(' ')[0];
        const car = (document.getElementById('carMakeModel').value || 'Car').trim().split(' ').slice(0,2).join('_');
        const now = new Date();
        const dateStr = now.toLocaleDateString('ru-RU').replace(/\./g, '-');
        const timeStr = now.toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'}).replace(/:/g, '-');
        return `–¢–ó_${manager}_${client}_${car}_${dateStr}_${timeStr}.pdf`;
    }

    // --- –ú–ê–ì–ò–Ø: –°–û–ó–î–ê–ù–ò–ï –ò–î–ï–ê–õ–¨–ù–û–ô –ö–û–ü–ò–ò ---
    function prepareClone() {
        const original = document.getElementById('printable-area');
        const cloneContainer = document.getElementById('clone-container');
        cloneContainer.innerHTML = ''; 
        
        // –ö–ª–æ–Ω–∏—Ä—É–µ–º
        const clone = original.cloneNode(true);
        clone.classList.add('pdf-mode'); // –ü—Ä–∏–º–µ–Ω—è–µ–º –∂–µ—Å—Ç–∫–∏–µ —Å—Ç–∏–ª–∏
        
        // –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—è –≤ —Ç–µ–∫—Å—Ç
        const inputs = clone.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            const val = input.value || '';
            const textDiv = document.createElement('div');
            textDiv.textContent = val;
            textDiv.className = 'pdf-text-value';
            
            if(input.id === 'budget' || input.classList.contains('budget-input')) {
                textDiv.classList.add('budget-val');
            }
            
            input.parentNode.replaceChild(textDiv, input);
        });

        cloneContainer.appendChild(clone);
        return clone;
    }

    function generateSmartPDF() {
        if (!validateForm()) return;

        const btn = document.getElementById('pdfBtn');
        const originalText = btn.innerText;
        btn.innerText = "–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ...";
        btn.disabled = true;

        const elementToPrint = prepareClone();
        const fileName = getFileName();

        const opt = {
            margin: [10, 10, 10, 10], // –û—Ç—Å—Ç—É–ø—ã (–º–º)
            filename: fileName,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { 
                scale: 2, 
                useCORS: true, 
                logging: false,
                scrollY: 0,
                windowWidth: 800 // –ó–ê–°–¢–ê–í–õ–Ø–ï–ú –¥—É–º–∞—Ç—å, —á—Ç–æ —ç–∫—Ä–∞–Ω —à–∏—Ä–æ–∫–∏–π
            },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(elementToPrint).output('blob').then(function(blob) {
            const file = new File([blob], fileName, { type: 'application/pdf' });
            
            // –ï—Å–ª–∏ –º–æ–±–∏–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
            if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                navigator.share({
                    files: [file],
                    title: '–¢–ó –Ω–∞ –∞–≤—Ç–æ'
                }).then(resetBtn).catch(() => {
                    // –ï—Å–ª–∏ –æ—Ç–º–µ–Ω–∏–ª–∏ —à–∞—Ä–∏–Ω–≥ - –ø—Ä–æ—Å—Ç–æ –∫–∞—á–∞–µ–º
                    saveDirectly(opt, elementToPrint);
                });
            } else {
                // –ö–æ–º–ø—å—é—Ç–µ—Ä
                saveDirectly(opt, elementToPrint);
            }
        }).catch(err => {
            console.error(err);
            saveDirectly(opt, elementToPrint); // –ü—Ä–æ–±—É–µ–º –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
        });

        function saveDirectly(options, el) {
            html2pdf().set(options).from(el).save().then(resetBtn);
        }

        function resetBtn() {
            btn.innerText = originalText;
            btn.disabled = false;
            document.getElementById('clone-container').innerHTML = '';
        }
    }
</script>
</body>
</html>
