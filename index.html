<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–æ—Ä–º–∞ –¢–ó –Ω–∞ –ø–æ–¥–±–æ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* --- –°–¢–ò–õ–ò –î–õ–Ø –≠–ö–†–ê–ù–ê --- */
        :root {
            --primary-color: #0056b3;
            --secondary-color: #f4f7f6;
            --text-color: #333;
            --border-color: #ccc;
            --budget-color: #0d47a1;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.4;
            color: var(--text-color);
            background-color: #e9ecef;
            margin: 0;
            padding: 10px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .logo-container {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        .logo-img {
            max-width: 100%;
            height: auto;
            max-height: 80px;
            display: inline-block;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .section-block {
            margin-bottom: 20px;
            page-break-inside: avoid;
        }

        h2 {
            background-color: var(--secondary-color);
            padding: 8px 15px;
            border-left: 5px solid var(--primary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        @media (max-width: 480px) {
            .form-grid { grid-template-columns: 1fr; }
        }

        .form-group { 
            margin-bottom: 10px; 
            page-break-inside: avoid; 
        }
        .form-group.full-width { grid-column: 1 / -1; }

        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            font-size: 0.85rem;
            color: #555;
        }

        input[type="text"], select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
            font-family: inherit;
        }
        textarea { resize: vertical; height: 60px; }

        .budget-block {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #bbdefb;
        }
        .budget-label {
            font-size: 1.1rem; color: var(--budget-color); margin-bottom: 8px;
        }
        .budget-input {
            font-weight: bold; font-size: 1.1rem; color: var(--budget-color);
        }

        .required { color: red; }

        .btn-container {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .btn {
            padding: 15px 30px;
            border: none; border-radius: 5px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer; color: white;
            width: 100%; max-width: 300px;
        }
        .btn-pdf { background-color: var(--primary-color); }
        /* –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–æ–ø–∫–∏ */
        .btn-pdf:disabled { background-color: #999; cursor: not-allowed; }

        /* --- –°–¢–ò–õ–ò –î–õ–Ø –ü–ï–ß–ê–¢–ò --- */
        @media print {
            body, html { margin: 0; padding: 0; background: #fff; }
            .container {
                width: 100% !important; max-width: none !important; margin: 0 !important;
                padding: 0 !important;
                box-shadow: none; border: none;
            }
            .logo-container { margin-bottom: 10px; }
            .logo-img { max-height: 60px; }
            h1 { margin-top: 0; margin-bottom: 5px; padding-bottom: 5px; font-size: 1.6rem; }
            .section-block { margin-bottom: 10px; }
            h2 { padding: 4px 10px; margin-bottom: 8px; font-size: 1rem; }
            .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px 20px; }
            .form-group { margin-bottom: 2px; }
            #budget-group.full-width, #car-model-group.full-width { grid-column: span 1 !important; }
            label { margin-bottom: 1px; font-size: 0.75rem; color: #666; }
            input, select, textarea {
                border: 1px solid #ddd !important;
                padding: 2px 5px;
                background: transparent !important;
                font-size: 0.85rem;
                font-weight: 600;
                color: #000 !important;
                height: auto;
            }
            textarea { height: auto !important; min-height: 25px; resize: none; overflow: visible; }
            .budget-block { padding: 5px !important; background: transparent !important; border: none !important; }
            .budget-label { font-size: 0.8rem; margin-bottom: 0; color: #000; }
            .budget-input { font-size: 1rem; border: 1px solid #0d47a1 !important; color: #0d47a1 !important; }
            select { appearance: none; -webkit-appearance: none; }
            .btn-container { display: none !important; }
        }
    </style>
</head>
<body>

<div class="container" id="printable-area">
    <!-- –õ–û–ì–û–¢–ò–ü (–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è logo.png) -->
    <div class="logo-container">
        <img src="logo.png" alt="Pard Auto" class="logo-img">
    </div>

    <h1>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –ø–æ–¥–±–æ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è</h1>

    <div class="section-block">
        <h2>1. –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞ (–ó–∞–ø–æ–ª–Ω—è–µ—Ç –ú–µ–Ω–µ–¥–∂–µ—Ä)</h2>
        <div class="form-grid">
            <div class="form-group">
                <label for="managerName">–ú–µ–Ω–µ–¥–∂–µ—Ä: <span class="required">*</span></label>
                <select id="managerName" required>
                    <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                    <option value="–ê—Ä—Ç–µ–º">–ê—Ä—Ç–µ–º</option>
                    <option value="–ú–∞–∫—Å–∏–º">–ú–∞–∫—Å–∏–º</option>
                    <option value="–†–æ–º–∞–Ω">–†–æ–º–∞–Ω</option>
                </select>
            </div>
            <div class="form-group">
                <label for="requestDate">–î–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞:</label>
                <input type="text" id="requestDate" readonly>
            </div>
        </div>
    </div>

    <div class="section-block">
        <h2>2. –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞</h2>
        <div class="form-grid">
            <div class="form-group">
                <label for="clientFIO">–§–ò–û –ö–ª–∏–µ–Ω—Ç–∞: <span class="required">*</span></label>
                <input type="text" id="clientFIO" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" required>
            </div>
            <div class="form-group">
                <label for="clientPhone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="text" id="clientPhone" placeholder="+7 (999) 000-00-00">
            </div>
        </div>
    </div>

    <div class="section-block">
        <h2>3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≤—Ç–æ–º–æ–±–∏–ª—è (–¢–ó –¥–ª—è –°–æ—Ä—Å–∏–Ω–≥–∞)</h2>
        <div class="form-grid">
            <div class="form-group full-width budget-block" id="budget-group">
                <label for="budget" class="budget-label">üéØ –ë—é–¥–∂–µ—Ç ¬´–ø–æ–¥ –∫–ª—é—á¬ª (–†–§): <span class="required">*</span></label>
                <input type="text" id="budget" class="budget-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¥–æ 3 500 000 —Ä—É–±." required>
            </div>

            <div class="form-group full-width" id="car-model-group">
                <label for="carMakeModel">–ú–∞—Ä–∫–∞ –∏ –ú–æ–¥–µ–ª—å: <span class="required">*</span></label>
                <input type="text" id="carMakeModel" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Kia Sorento –∏–ª–∏ BMW X3" required>
            </div>

            <div class="form-group">
                <label for="carYears">–ì–æ–¥—ã –≤—ã–ø—É—Å–∫–∞:</label>
                <input type="text" id="carYears" placeholder="–ù–∞–ø—Ä: 2020-2022">
            </div>

            <div class="form-group">
                <label for="engineType">–î–≤–∏–≥–∞—Ç–µ–ª—å:</label>
                <input type="text" id="engineType" placeholder="–ù–∞–ø—Ä: –î–∏–∑–µ–ª—å 2.2">
            </div>
            <div class="form-group">
                <label for="driveType">–ü—Ä–∏–≤–æ–¥:</label>
                <select id="driveType">
                    <option value="–ù–µ –≤–∞–∂–Ω–æ">–ù–µ –≤–∞–∂–Ω–æ</option>
                    <option value="–ü–æ–ª–Ω—ã–π (4WD/AWD)">–ü–æ–ª–Ω—ã–π (4WD/AWD)</option>
                    <option value="–ü–µ—Ä–µ–¥–Ω–∏–π (FWD)">–ü–µ—Ä–µ–¥–Ω–∏–π (FWD)</option>
                    <option value="–ó–∞–¥–Ω–∏–π (RWD)">–ó–∞–¥–Ω–∏–π (RWD)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="transmission">–ö–æ—Ä–æ–±–∫–∞:</label>
                <select id="transmission">
                    <option value="–ê–≤—Ç–æ–º–∞—Ç (–ª—é–±–æ–π)">–ê–≤—Ç–æ–º–∞—Ç (–ª—é–±–æ–π)</option>
                    <option value="–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ê–ö–ü–ü">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ê–ö–ü–ü</option>
                    <option value="–†–æ–±–æ—Ç">–†–æ–±–æ—Ç</option>
                    <option value="–í–∞—Ä–∏–∞—Ç–æ—Ä">–í–∞—Ä–∏–∞—Ç–æ—Ä</option>
                    <option value="–ú–µ—Ö–∞–Ω–∏–∫–∞">–ú–µ—Ö–∞–Ω–∏–∫–∞</option>
                </select>
            </div>
             <div class="form-group">
                <label for="maxMileage">–ü—Ä–æ–±–µ–≥ (–∫–º):</label>
                <input type="text" id="maxMileage" placeholder="–ù–∞–ø—Ä: –¥–æ 80 000">
            </div>

            <div class="form-group">
                <label for="importRegion">–û—Ç–∫—É–¥–∞ –ø—Ä–∏–≤–µ–∑—Ç–∏:</label>
                <select id="importRegion">
                    <option value="–ù–µ –≤–∞–∂–Ω–æ">–ù–µ –≤–∞–∂–Ω–æ</option>
                    <option value="–ö–∏—Ç–∞–π">–ö–∏—Ç–∞–π</option>
                    <option value="–ö–æ—Ä–µ—è">–ö–æ—Ä–µ—è</option>
                    <option value="–ï–≤—Ä–æ–ø–∞">–ï–≤—Ä–æ–ø–∞</option>
                    <option value="–Ø–ø–æ–Ω–∏—è">–Ø–ø–æ–Ω–∏—è</option>
                    <option value="–ö–∏—Ä–≥–∏–∑–∏—è">–ö–∏—Ä–≥–∏–∑–∏—è</option>
                    <option value="–†–ë">–†–ë (–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–µ–ª–∞—Ä—É—Å—å)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="deliveryCity">–ì–æ—Ä–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏:</label>
                <input type="text" id="deliveryCity" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞">
            </div>

            <div class="form-group">
                <label for="customsClearance">–†–∞—Å—Ç–∞–º–æ–∂–∫–∞:</label>
                <select id="customsClearance">
                    <option value="–†–§">–†–§</option>
                    <option value="–ö–∏—Ä–≥–∏–∑–∏—è">–ö–∏—Ä–≥–∏–∑–∏—è</option>
                    <option value="–†–ë">–†–ë (–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–µ–ª–∞—Ä—É—Å—å)</option>
                </select>
            </div>

            <div class="form-group full-width">
                <label for="colors">–¶–≤–µ—Ç (–ö—É–∑–æ–≤/–°–∞–ª–æ–Ω):</label>
                <input type="text" id="colors" placeholder="–ù–∞–ø—Ä: –ë–µ–ª—ã–π –∏–ª–∏ –°–µ—Ä—ã–π –∫—É–∑–æ–≤ / –¢–µ–º–Ω—ã–π —Å–∞–ª–æ–Ω">
            </div>
            
            <div class="form-group full-width">
                <label for="mustHaves">–í–∞–∂–Ω—ã–µ –æ–ø—Ü–∏–∏ (Must Have):</label>
                <textarea id="mustHaves" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–∞–Ω–æ—Ä–∞–º–∞, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è —Å–∏–¥–µ–Ω–∏–π."></textarea>
            </div>

            <div class="form-group full-width">
                <label for="additionalComments">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</label>
                <textarea id="additionalComments" placeholder="–õ—é–±–∞—è –¥—Ä—É–≥–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è."></textarea>
            </div>
        </div>
    </div>
</div>

<div class="btn-container">
    <button class="btn btn-pdf" id="pdfBtn" onclick="handlePdfGeneration()">–°–∫–∞—á–∞—Ç—å / –û—Ç–ø—Ä–∞–≤–∏—Ç—å PDF</button>
</div>

<script>
    window.onload = function() {
        const today = new Date();
        document.getElementById('requestDate').value = today.toLocaleString('ru-RU', { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    };

    function validateForm() {
        const managerInput = document.getElementById('managerName');
        const clientInput = document.getElementById('clientFIO');
        const budgetInput = document.getElementById('budget');
        const carInput = document.getElementById('carMakeModel');
        if (!managerInput.value) { alert("–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞!"); managerInput.focus(); return false; }
        if (!clientInput.value.trim()) { alert("–£–∫–∞–∂–∏—Ç–µ –§–ò–û –∫–ª–∏–µ–Ω—Ç–∞!"); clientInput.focus(); return false; }
        if (!budgetInput.value.trim()) { alert("–£–∫–∞–∂–∏—Ç–µ –±—é–¥–∂–µ—Ç!"); budgetInput.focus(); return false; }
        if (!carInput.value.trim()) { alert("–£–∫–∞–∂–∏—Ç–µ –ú–∞—Ä–∫—É –∞–≤—Ç–æ!"); carInput.focus(); return false; }
        return true;
    }

    function getFileName() {
        const managerName = document.getElementById('managerName').value;
        const clientNameShort = document.getElementById('clientFIO').value.trim().split(' ')[0];
        const carModelShort = document.getElementById('carMakeModel').value.trim().split(' ').slice(0, 2).join('_').replace(/[\s/\\,.]+/g, '');
        
        const now = new Date();
        const dateStr = now.toLocaleDateString('ru-RU').replace(/\./g, '-');
        const timeStr = now.toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'}).replace(/:/g, '-');
        
        return `–¢–ó_${managerName}_${clientNameShort}_${carModelShort}_${dateStr}_${timeStr}.pdf`;
    }

    function handlePdfGeneration() {
        if (!validateForm()) return;
        
        const btn = document.getElementById('pdfBtn');
        const originalText = btn.innerText;
        btn.innerText = "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...";
        btn.disabled = true;

        window.scrollTo(0, 0);

        const element = document.getElementById('printable-area');
        const fileName = getFileName();
        
        const opt = {
            margin: [5, 10, 5, 10], 
            filename: fileName,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true, logging: false, scrollY: 0 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
            pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
        };

        // –õ–æ–≥–∏–∫–∞: –µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ñ–∞–π–ª–æ–º" (–º–æ–±–∏–ª—å–Ω—ã–µ), –¥–µ–ª–∞–µ–º —ç—Ç–æ.
        // –ï—Å–ª–∏ –Ω–µ—Ç (–∫–æ–º–ø—å—é—Ç–µ—Ä) ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º.
        if (navigator.share && navigator.canShare) {
            html2pdf().set(opt).from(element).output('blob').then(function(blob) {
                const file = new File([blob], fileName, { type: 'application/pdf' });
                
                if (navigator.canShare({ files: [file] })) {
                    navigator.share({
                        files: [file],
                        title: '–¢–ó –Ω–∞ –ø–æ–¥–±–æ—Ä',
                        text: '–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–¥–±–æ—Ä –∞–≤—Ç–æ ' + fileName
                    }).then(() => {
                        console.log('–£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
                        btn.innerText = originalText;
                        btn.disabled = false;
                    }).catch((error) => {
                        console.log('–û—à–∏–±–∫–∞ —à–∞—Ä–∏–Ω–≥–∞', error);
                        // –ï—Å–ª–∏ –æ—Ç–º–µ–Ω–∏–ª–∏ –∏–ª–∏ –æ—à–∏–±–∫–∞ ‚Äî –ø—ã—Ç–∞–µ–º—Å—è –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        saveDirectly(opt, element);
                        btn.innerText = originalText;
                        btn.disabled = false;
                    });
                } else {
                    saveDirectly(opt, element);
                    btn.innerText = originalText;
                    btn.disabled = false;
                }
            });
        } else {
            // –û–±—ã—á–Ω—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä
            saveDirectly(opt, element);
            btn.innerText = originalText;
            btn.disabled = false;
        }
    }

    function saveDirectly(opt, element) {
        html2pdf().set(opt).from(element).save();
    }
</script>
</body>
</html>
